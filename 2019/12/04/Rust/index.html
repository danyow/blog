<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Rust</title>
  <meta name="description" content="Title: Mac 下学习使用 Rust">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.danyow.cn/2019/12/04/Rust/">
  
  
  <link rel="alternate" type="application/rss+xml" title="📒 Danyow" href="https://blog.danyow.cn/feed.xml">

  

  
  <meta property="og:title" content="Rust">
  <meta property="og:site_name" content="📒 Danyow">
  <meta property="og:url" content="https://blog.danyow.cn/2019/12/04/Rust/">
  <meta property="og:description" content="Title: Mac 下学习使用 Rust">
  
  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Rust">
  <meta name="twitter:description" content="Title: Mac 下学习使用 Rust">
  
  

  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700&display=swap" rel="stylesheet">

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">📒 Danyow</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">关于</a>
      
        
        <a class="page-link" href="/archives/">归档</a>
      
        
        <a class="page-link" href="https://github.com/danyow">GitHub</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Rust</h1>
    
    <p class="post-meta"><time datetime="2019-12-04T14:39:06+00:00" itemprop="datePublished">Dec 4, 2019</time> •
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/mac/">Mac</a>,
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/rust/">Rust</a>,
      
    
      
    
  
    
    
      
    
      
    
      
    
      
    
      
        <a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  



</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Title: Mac 下学习使用 <em>Rust</em></p>

<h2 id="安装">安装</h2>

<h3 id="brew-安装">brew 安装</h3>

<p>测试之后, 环境有很多内容有没安装上, 估计也是没有配置环境的原因</p>

<h3 id="官网方法">官网方法</h3>

<ol>
  <li>
    <p><code class="highlighter-rouge">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code></p>
  </li>
  <li>
    <p>导入环境参数 <code class="highlighter-rouge">export PATH="$PATH:$HOME/.cargo/bin"</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">rustc --version</code></p>
  </li>
</ol>

<h2 id="入门">入门</h2>

<h3 id="rustc-编译">rustc 编译</h3>

<p>随便写一个 <code class="highlighter-rouge">main.rs</code> 文件, 然后键入下述内容.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Hello, world!"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>然后执行<code class="highlighter-rouge">rustc main.rs</code>得到编译后的可执行文件<code class="highlighter-rouge">./main</code>即可看到打印</p>

<h3 id="cargo">Cargo</h3>

<p>如果安装的时候用的是官网的方法的话, 是会让你选择第几个安装方式, 我们通常选择第一个采用默认的方式, 这样就会把Cargo所需要的也就一起下载安装下来了. 在到我们配置环境输入的<code class="highlighter-rouge">PATH</code>也是一样</p>

<ol>
  <li>
    <p>新建项目
<code class="highlighter-rouge">cargo new hello_cargo</code></p>
  </li>
  <li>
    <p>编译项目
<code class="highlighter-rouge">cargo build</code> or <code class="highlighter-rouge">cargo build --release</code></p>
  </li>
  <li>
    <p>运行项目
<code class="highlighter-rouge">cargo run</code></p>
  </li>
</ol>

<h3 id="编写猜谜游戏">编写猜谜游戏</h3>

<ol>
  <li>
    <p>直接编写</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>    <span class="c">// 使用标准库的io</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"Guess the number!"</span><span class="p">);</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"Please input your guess."</span><span class="p">);</span>

     <span class="k">let</span> <span class="k">mut</span> <span class="n">guess</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span> <span class="c">// 定义一个可变的变量</span>

     <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span>   <span class="c">// 换行的原因只是因为过长了</span>
         <span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read line"</span><span class="p">);</span> <span class="c">// 处理可能的报错</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"You guessed: {}"</span><span class="p">,</span> <span class="n">guess</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>加入<code class="highlighter-rouge">rand</code>库</p>

    <p>在<code class="highlighter-rouge">Cargo.toml</code>文件中加入</p>

    <div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nn">[dependencies]</span>

 <span class="py">rand</span> <span class="p">=</span> <span class="s">"0.3.14"</span>
</code></pre></div>    </div>

    <p>然后编译<code class="highlighter-rouge">cargo build</code>或者是<code class="highlighter-rouge">cargo run</code>可能会遇到
 <code class="highlighter-rouge">Blocking waiting for file lock on package cache</code>
 如果执行得是<code class="highlighter-rouge">cargo update</code>就不会遇到<code class="highlighter-rouge">Cargo.lock</code>文件了</p>

    <p>这里指定了<code class="highlighter-rouge">0.3.14</code>版本并不是真的就只使用该版本, 而是会使用兼容该版本的更高版本</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">rand</span><span class="p">::</span><span class="n">Rng</span><span class="p">;</span>  <span class="c">// 导入 随机库</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"Guess the number!"</span><span class="p">);</span>

     <span class="k">let</span> <span class="n">secret_number</span> <span class="o">=</span> <span class="nn">rand</span><span class="p">::</span><span class="nf">thread_rng</span><span class="p">()</span><span class="nf">.gen_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">);</span>   <span class="c">// 生成一个 0 ~ 100 的随机数</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"The secret number is: {}"</span><span class="p">,</span> <span class="n">secret_number</span><span class="p">);</span>    <span class="c">// 测试打印</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"Please input your guess."</span><span class="p">);</span>

     <span class="k">let</span> <span class="k">mut</span> <span class="n">guess</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

     <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span>
         <span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read line"</span><span class="p">);</span>

     <span class="c">// trim 的是就是删除某些东西 由于 键入的时候最后面会敲击回车 导致\n会加入进来</span>
     <span class="k">let</span> <span class="n">guess</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="n">guess</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span>   <span class="c">// 用 同一个变量名 去覆盖 guess 并转成 u32类型</span>
         <span class="nf">.expect</span><span class="p">(</span><span class="s">"Please type a number!"</span><span class="p">);</span>   <span class="c">// 转换类型也是有可能报错的</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"You guessed: {}"</span><span class="p">,</span> <span class="n">guess</span><span class="p">);</span>

     <span class="k">match</span> <span class="n">guess</span><span class="nf">.cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">secret_number</span><span class="p">)</span> <span class="p">{</span>
         <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"Too small!"</span><span class="p">),</span>
         <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"Too big!"</span><span class="p">),</span>
         <span class="nn">Ordering</span><span class="p">::</span><span class="n">Equal</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"You win!"</span><span class="p">),</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>加入循环</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// --snip--</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"The secret number is: {}"</span><span class="p">,</span> <span class="n">secret_number</span><span class="p">);</span>

     <span class="k">loop</span> <span class="p">{</span>  <span class="c">// 加入循环</span>
         <span class="nd">println!</span><span class="p">(</span><span class="s">"Please input your guess."</span><span class="p">);</span>

         <span class="c">// --snip--</span>

         <span class="k">match</span> <span class="n">guess</span><span class="nf">.cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">secret_number</span><span class="p">)</span> <span class="p">{</span>
             <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"Too small!"</span><span class="p">),</span>
             <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"Too big!"</span><span class="p">),</span>
             <span class="nn">Ordering</span><span class="p">::</span><span class="n">Equal</span> <span class="k">=&gt;</span> <span class="p">{</span>
                 <span class="nd">println!</span><span class="p">(</span><span class="s">"You win!"</span><span class="p">);</span>
                 <span class="k">break</span><span class="p">;</span>  <span class="c">// 在这里退出循环</span>
             <span class="p">},</span>
         <span class="p">}</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>处理非数字的输入</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// --snip--</span>

 <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">guess</span><span class="p">)</span>
     <span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read line"</span><span class="p">);</span>

 <span class="c">// 加入match来对报错的 continue来处理非数字的输入</span>
 <span class="k">let</span> <span class="n">guess</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="k">match</span> <span class="n">guess</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span> <span class="p">{</span>
     <span class="nf">Ok</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">num</span><span class="p">,</span>
     <span class="nf">Err</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">continue</span><span class="p">,</span>
 <span class="p">};</span>

 <span class="nd">println!</span><span class="p">(</span><span class="s">"You guessed: {}"</span><span class="p">,</span> <span class="n">guess</span><span class="p">);</span>

 <span class="c">// --snip--</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="通用编程概念">通用编程概念</h3>

<h4 id="变量和可变性">变量和可变性</h4>

<ol>
  <li>这里的变量不是指能变的量, 而是一个定义, 但只要赋予了 <code class="highlighter-rouge">mut</code> 才是真的可以变</li>
  <li>常量的命名规则 单词全大写 下划线分隔 就连int <code class="highlighter-rouge">100,000</code> 都可以表示为 <code class="highlighter-rouge">100_000</code></li>
  <li>变量可以被重复声明并覆盖原值 但不能改变原有数据类型 也就是不能 string =&gt; int</li>
</ol>

<h4 id="资料类型">资料类型</h4>

<ol>
  <li>
    <p>编译时需要帮忙确定类型</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">guess</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="s">"42"</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Not a number!"</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>整型的表示形式有</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/*
     小数        98_222
     十六        0xff
     八进        0o77
     二元        0b1111_0000
     字节（u8仅） b'A'
 */</span>
</code></pre></div>    </div>
  </li>
  <li>bool类型就只有真假 不会默认帮忙转换</li>
  <li>
    <p>元组</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">f64</span><span class="p">,</span> <span class="nb">u8</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mf">6.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
     <span class="k">let</span> <span class="n">five_hundred</span> <span class="o">=</span> <span class="n">x</span><span class="err">.</span><span class="mi">0</span><span class="p">;</span>
     <span class="k">let</span> <span class="n">six_point_four</span> <span class="o">=</span> <span class="n">x</span><span class="err">.</span><span class="mi">1</span><span class="p">;</span>
     <span class="k">let</span> <span class="n">one</span> <span class="o">=</span> <span class="n">x</span><span class="err">.</span><span class="mi">2</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>数组</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">c</span><span class="p">:</span> <span class="p">[</span><span class="nb">i32</span><span class="p">;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">;</span> <span class="mi">5</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">first</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">second</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="函数">函数</h4>

<ol>
  <li>不带;表示返回值</li>
  <li>
    <p>指定返回值</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">plus_one</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
     <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="注释">注释</h4>

<p>讲解Crates.io的时候才说</p>

<h4 id="控制流">控制流</h4>

<ol>
  <li>
    <p>使用<code class="highlighter-rouge">if</code>的<code class="highlighter-rouge">let</code>语句</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">condition</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
     <span class="k">let</span> <span class="n">number</span> <span class="o">=</span> <span class="k">if</span> <span class="n">condition</span> <span class="p">{</span>
         <span class="mi">5</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="mi">6</span>
     <span class="p">};</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"The value of number is: {}"</span><span class="p">,</span> <span class="n">number</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>从循环里面返回值出来</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="k">loop</span> <span class="p">{</span>
         <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

         <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">10</span> <span class="p">{</span>
             <span class="k">break</span> <span class="n">counter</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span><span class="c">// 我在想 这里没有; 为什么也能有值返回出去呢?</span>
         <span class="p">}</span>
     <span class="p">};</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"The result is {}"</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>遍历</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">];</span>

     <span class="c">// 方法1</span>
     <span class="k">for</span> <span class="n">element</span> <span class="n">in</span> <span class="n">a</span><span class="nf">.iter</span><span class="p">()</span> <span class="p">{</span>
         <span class="nd">println!</span><span class="p">(</span><span class="s">"the value is: {}"</span><span class="p">,</span> <span class="n">element</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="c">// 方法2</span>
     <span class="k">for</span> <span class="n">number</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">)</span><span class="nf">.rev</span><span class="p">()</span> <span class="p">{</span>
         <span class="nd">println!</span><span class="p">(</span><span class="s">"{}!"</span><span class="p">,</span> <span class="n">number</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="c">// 方法3</span>
     <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">{</span>
         <span class="nd">println!</span><span class="p">(</span><span class="s">"the value is: {}"</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
         <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="所有权">所有权</h3>

<h4 id="什么是所有权">什么是所有权</h4>

<ol>
  <li>
    <p>每个内存只能被所有一次, 一旦被接管了就没了.</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 下述代码就会报错</span>
 <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span><span class="p">;</span>

 <span class="nd">println!</span><span class="p">(</span><span class="s">"{}, world!"</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span>

 <span class="cm">/*
     error[E0382]: use of moved value: `s1`
     --&gt; src/main.rs:5:28
     |
     3 |     let s2 = s1;
     |         -- value moved here
     4 |
     5 |     println!("{}, world!", s1);
     |                            ^^ value used here after move
     |
     = note: move occurs because `s1` has type `std::string::String`, which does
     not implement the `Copy` trait
 */</span>
</code></pre></div>    </div>
  </li>
  <li>如果想要拿到一样的内容的话 使用 <code class="highlighter-rouge">clone</code></li>
  <li>对基础数据类型操作的是 会自动调用 <code class="highlighter-rouge">copy</code>, 由于都是在栈区, 不会产生新的内存空间</li>
  <li>如果直接把某个变量交付给某个函数, 而该函数没有移交所有权出来的话, 他将不能再被使用了</li>
</ol>

<h3 id="引用和借阅">引用和借阅</h3>

<ol>
  <li>
    <p><code class="highlighter-rouge">&amp;</code> 表示引用该参数, 但不能进行变更, 如果要变更的话 需要 <code class="highlighter-rouge">&amp;mut</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>

     <span class="nf">change</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">s</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">change</span><span class="p">(</span><span class="n">some_string</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">some_string</span><span class="nf">.push_str</span><span class="p">(</span><span class="s">", world"</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>不能有两次可变引用, 因为不知道依据谁的改变</li>
  <li>
    <p>同上, 如果还存在多个后续依旧会使用的不可变引用时候, 不能创建可变引用, 因为不可变的引用是不知道可变引用的存在的, 但如果在使用后并且后续不再使用了之后, 就允许创建可变引用了</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>

 <span class="k">let</span> <span class="n">r1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">;</span> <span class="c">// no problem</span>
 <span class="k">let</span> <span class="n">r2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">;</span> <span class="c">// no problem</span>
 <span class="nd">println!</span><span class="p">(</span><span class="s">"{} and {}"</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">);</span>  <span class="c">// 这里使用之后 后续就不再使用了 说明是可以的</span>
 <span class="c">// r1 and r2 are no longer used after this point</span>

 <span class="k">let</span> <span class="n">r3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">s</span><span class="p">;</span> <span class="c">// no problem</span>
 <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">r3</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>悬空, 什么意思呢, 可以理解为僵尸指针</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">reference_to_nothing</span> <span class="o">=</span> <span class="nf">dangle</span><span class="p">();</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">dangle</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">String</span> <span class="p">{</span>    <span class="c">// 这里将返回一个带有引用的数据类型</span>
     <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>  <span class="c">// 生成一个新的数据类型, 开辟可以一个新的内存空间</span>

     <span class="o">&amp;</span><span class="n">s</span>  <span class="c">// 移交引用出去 代表是 我只是借你拿去用的意思</span>
 <span class="p">}</span>   <span class="c">// 但这里就已经被释放了 产生 僵尸指针</span>

 <span class="k">fn</span> <span class="nf">no_dangle</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>

     <span class="n">s</span>   <span class="c">// 这里是把所有权给出去了 代表是 我开辟的空间 我不要了 你拿去用吧</span>
 <span class="p">}</span>   <span class="c">// 这样给出去的内存就不会被释放了</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="切片类型">切片类型</h4>

<ol>
  <li>
    <p>先看一个获取第一个单词的函数</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 借阅一个字符串   返回单词的下标</span>
 <span class="k">fn</span> <span class="nf">first_word</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
     <span class="c">// 转换为数组</span>
     <span class="k">let</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.as_bytes</span><span class="p">();</span>

     <span class="c">// 遍历 bytes.iter() 并且创建迭代器 enumerate() 可以理解为 enumerate() 会产生出一个元组来</span>
     <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span> <span class="n">in</span> <span class="n">bytes</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
         <span class="c">//  借阅到了 item</span>
         <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">b</span><span class="sc">' '</span> <span class="p">{</span>
             <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="n">s</span><span class="nf">.len</span><span class="p">()</span> <span class="c">// 乍一看没有问题 但, 其实这里涉及到了很多问题, 比方单词长度未知和 s 被销毁了 这组数据就失效了</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>引入切片</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">);</span>

     <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.len</span><span class="p">();</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="o">..</span><span class="mi">2</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="o">..</span><span class="n">len</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="o">..</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">len</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="o">..</span><span class="p">];</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">&amp;str</code> 表示的是切片类型 <code class="highlighter-rouge">&amp;String</code> 表示的字符串类型</p>
  </li>
  <li>
    <p>有了切片这个概念之后就可以改写取第一个单词的函数了</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">first_word</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.as_bytes</span><span class="p">();</span>

     <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span> <span class="n">in</span> <span class="n">bytes</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">b</span><span class="sc">' '</span> <span class="p">{</span>
             <span class="k">return</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">i</span><span class="p">];</span>    <span class="c">// 直接返回切片</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="c">// 刚好这里的 s 是借来的 所以直接拿着这玩意 转借给别人就行了 没我啥事了的意思</span>
     <span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="o">..</span><span class="p">]</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>使用上述代码</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello world"</span><span class="p">);</span>

     <span class="k">let</span> <span class="n">word</span> <span class="o">=</span> <span class="nf">first_word</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span> <span class="c">// 这个切片还是用的 s 的</span>

     <span class="n">s</span><span class="nf">.clear</span><span class="p">();</span> <span class="c">// 这里就会直接报错了 因为会获取s的可变引用并且把它清空, 而 world是 first_word 借了s又转手给了word的一个不可变引用</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"the first word is: {}"</span><span class="p">,</span> <span class="n">word</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>把传入的 <code class="highlighter-rouge">&amp;String</code> 类型变成 <code class="highlighter-rouge">&amp;str</code> 类型 就可以接受 切片和字符串了 因为字符串就是全切片</li>
  <li>
    <p>其他的切片</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>    <span class="c">// 他的类型是   [i32; 5]</span>
     <span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">];</span>       <span class="c">// 切片的类型是 &amp;[i32]</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="使用结构体来构造相关数据">使用结构体来构造相关数据</h3>

<h4 id="定义和实例化结构">定义和实例化结构</h4>

<ol>
  <li>
    <p>定义一个结构体</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">struct</span> <span class="n">User</span> <span class="p">{</span>
     <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>   <span class="c">// 现在先不声明为 &amp;str 切片类型 会涉及到生命周期</span>
     <span class="n">email</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
     <span class="n">sign_in_count</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
     <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">build_user</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">User</span> <span class="p">{</span>
     <span class="n">User</span> <span class="p">{</span>
         <span class="n">email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
         <span class="n">username</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
         <span class="n">active</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
         <span class="n">sign_in_count</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="p">}</span>
 <span class="p">}</span>
 <span class="c">// 简化写法</span>
 <span class="k">fn</span> <span class="nf">build_user</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">User</span> <span class="p">{</span>
     <span class="n">User</span> <span class="p">{</span>
         <span class="n">email</span><span class="p">,</span>
         <span class="n">username</span><span class="p">,</span>
         <span class="n">active</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
         <span class="n">sign_in_count</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">user1</span> <span class="o">=</span> <span class="n">User</span> <span class="p">{</span>
         <span class="n">email</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"someone@example.com"</span><span class="p">),</span>
         <span class="n">username</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"someusername123"</span><span class="p">),</span>
         <span class="n">active</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span>
         <span class="n">sign_in_count</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="p">};</span>

     <span class="c">// 点语法直接更改</span>
     <span class="n">user1</span><span class="py">.email</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"anotheremail@example.com"</span><span class="p">);</span>

     <span class="c">// 新建user2</span>
     <span class="k">let</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">User</span> <span class="p">{</span>
         <span class="n">email</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"another@example.com"</span><span class="p">),</span>
         <span class="n">username</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"anotherusername567"</span><span class="p">),</span>
         <span class="n">active</span><span class="p">:</span> <span class="n">user1</span><span class="py">.active</span><span class="p">,</span>
         <span class="n">sign_in_count</span><span class="p">:</span> <span class="n">user1</span><span class="py">.sign_in_count</span><span class="p">,</span>
     <span class="p">};</span>

     <span class="c">// 但可以写成这样</span>
     <span class="k">let</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">User</span> <span class="p">{</span>
         <span class="n">email</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"another@example.com"</span><span class="p">),</span>
         <span class="n">username</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"anotherusername567"</span><span class="p">),</span>
         <span class="o">..</span><span class="n">user1</span> <span class="c">// 其他字段沿用该实例</span>
     <span class="p">};</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>元组结构</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">struct</span> <span class="nf">Color</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">);</span>
 <span class="k">struct</span> <span class="nf">Point</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">);</span>

 <span class="k">let</span> <span class="n">black</span> <span class="o">=</span> <span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">origin</span> <span class="o">=</span> <span class="nf">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>打印结构 首先添加 <code class="highlighter-rouge">#[derive(Debug)]</code> 和 然后改 <code class="highlighter-rouge">{}</code> 为 <code class="highlighter-rouge">{:?}</code> 或 <code class="highlighter-rouge">{:#?}</code> 多行打印
单行打印 : 表示打印出来的键值中间的 : ? 表示的是 值 # 表示立起来 变成多行 形式主义.. 个人理解</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">#</span><span class="p">[</span><span class="nf">derive</span><span class="p">(</span><span class="n">Debug</span><span class="p">)]</span>
 <span class="k">struct</span> <span class="n">Rectangle</span> <span class="p">{</span>
     <span class="n">width</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
     <span class="n">height</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">test_rect</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">rect1</span> <span class="o">=</span> <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">50</span> <span class="p">};</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"rect1 is {:?}"</span><span class="p">,</span> <span class="n">rect1</span><span class="p">);</span>   <span class="c">// 表示的意思是</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"rect1 is {:#?}"</span><span class="p">,</span> <span class="n">rect1</span><span class="p">);</span>
 <span class="p">}</span>

</code></pre></div>    </div>
  </li>
</ol>

<h4 id="方块语法">方块语法</h4>

<ol>
  <li>
    <p>实现一个方法</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">#</span><span class="p">[</span><span class="nf">derive</span><span class="p">(</span><span class="n">Debug</span><span class="p">)]</span>
 <span class="k">struct</span> <span class="n">Rectangle</span> <span class="p">{</span>
     <span class="n">width</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
     <span class="n">height</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
 <span class="p">}</span>

 <span class="c">// 实现 可以有多个实现</span>
 <span class="k">impl</span> <span class="n">Rectangle</span> <span class="p">{</span>
     <span class="c">// 这里的self都只是借来的 只做访问变量使用</span>
     <span class="c">// 但如果要用来修改其内容的话 也是需要加上mut</span>
     <span class="k">fn</span> <span class="nf">area</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u32</span> <span class="p">{</span>
         <span class="k">self</span><span class="py">.width</span> <span class="o">*</span> <span class="k">self</span><span class="py">.height</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">impl</span> <span class="n">Rectangle</span> <span class="p">{</span>
     <span class="c">// 可以理解为定义了一个 类函数 只能通过类来调用 调用方式 采用 :: 双冒号形式</span>
     <span class="k">fn</span> <span class="nf">square</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">u32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Rectangle</span> <span class="p">{</span>
         <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">size</span> <span class="p">}</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">rect1</span> <span class="o">=</span> <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">50</span> <span class="p">};</span>

     <span class="nd">println!</span><span class="p">(</span>
         <span class="s">"The area of the rectangle is {} square pixels."</span><span class="p">,</span>
         <span class="n">rect1</span><span class="nf">.area</span><span class="p">()</span>
     <span class="p">);</span>

     <span class="k">let</span> <span class="n">sq</span> <span class="o">=</span> <span class="nn">Rectangle</span><span class="p">::</span><span class="nf">square</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
 <span class="p">}</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p>自动修改调用的第一个参数类型, 仅仅针对 <code class="highlighter-rouge">self</code> 参数   会自动添加他的变体 <code class="highlighter-rouge">&amp;</code>，<code class="highlighter-rouge">&amp;mut</code> 或 <code class="highlighter-rouge">*</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="nf">allow</span><span class="p">(</span><span class="n">unused_variables</span><span class="p">)]</span>
 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="nd">#[derive(Debug,Copy,Clone)]</span>
     <span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
         <span class="n">x</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
         <span class="n">y</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
     <span class="p">}</span>

     <span class="k">impl</span> <span class="n">Point</span> <span class="p">{</span>
         <span class="k">fn</span> <span class="nf">distance</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Point</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
             <span class="k">let</span> <span class="n">x_squared</span> <span class="o">=</span> <span class="nn">f64</span><span class="p">::</span><span class="nf">powi</span><span class="p">(</span><span class="n">other</span><span class="py">.x</span> <span class="err">-</span> <span class="k">self</span><span class="py">.x</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
             <span class="k">let</span> <span class="n">y_squared</span> <span class="o">=</span> <span class="nn">f64</span><span class="p">::</span><span class="nf">powi</span><span class="p">(</span><span class="n">other</span><span class="py">.y</span> <span class="err">-</span> <span class="k">self</span><span class="py">.y</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

             <span class="nn">f64</span><span class="p">::</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">x_squared</span> <span class="o">+</span> <span class="n">y_squared</span><span class="p">)</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="k">let</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span> <span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mf">0.0</span> <span class="p">};</span>
     <span class="k">let</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">Point</span> <span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mf">6.5</span> <span class="p">};</span>
     <span class="c">// 这两个方法的调用时一无所谓的</span>
     <span class="n">p1</span><span class="nf">.distance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p2</span><span class="p">);</span>
     <span class="p">(</span><span class="o">&amp;</span><span class="n">p1</span><span class="p">)</span><span class="nf">.distance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p2</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="枚举">枚举</h4>

<ol>
  <li>
    <p>不得不承认 这么没有很吸引我</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 正常使用</span>
 <span class="k">enum</span> <span class="n">IpAddrKind</span> <span class="p">{</span>
     <span class="n">V4</span><span class="p">,</span>
     <span class="n">V6</span><span class="p">,</span>
 <span class="p">}</span>
 <span class="c">// 混用</span>
 <span class="k">enum</span> <span class="n">IpAddr</span> <span class="p">{</span>
     <span class="nf">V4</span><span class="p">(</span><span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">),</span>
     <span class="nf">V6</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
 <span class="p">}</span>

 <span class="k">struct</span> <span class="n">Ipv4Addr</span> <span class="p">{</span>
 <span class="c">// --snip--</span>
 <span class="p">}</span>

 <span class="k">struct</span> <span class="n">Ipv6Addr</span> <span class="p">{</span>
     <span class="c">// --snip--</span>
 <span class="p">}</span>

 <span class="c">// 结构体使用</span>
 <span class="k">enum</span> <span class="n">IpAddr</span> <span class="p">{</span>
     <span class="nf">V4</span><span class="p">(</span><span class="n">Ipv4Addr</span><span class="p">),</span>
     <span class="nf">V6</span><span class="p">(</span><span class="n">Ipv6Addr</span><span class="p">),</span>
 <span class="p">}</span>

 <span class="c">// 强大所在</span>
 <span class="k">enum</span> <span class="n">Message</span> <span class="p">{</span>
     <span class="n">Quit</span><span class="p">,</span>
     <span class="n">Move</span> <span class="p">{</span> <span class="n">x</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">i32</span> <span class="p">},</span>
     <span class="nf">Write</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
     <span class="nf">ChangeColor</span><span class="p">(</span><span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">,</span> <span class="nb">i32</span><span class="p">),</span>
 <span class="p">}</span>

 <span class="k">impl</span> <span class="n">Message</span> <span class="p">{</span>
     <span class="c">// 还能...实现 函数!!!</span>
     <span class="k">fn</span> <span class="nf">call</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
         <span class="c">// method body would be defined here</span>
     <span class="p">}</span>
 <span class="p">}</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p>Option
 null的发明者Tony Hoare在2009年的演讲“ Null References：十亿美元的错误”中说：</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     我称之为我的十亿美元错误。当时，我正在设计第一个全面的类型系统，以使用面向对象的语言进行引用。我的目标是确保所有引用的使用都绝对安全，并由编译器自动执行检查。但是我忍不住要插入一个空引用的诱惑，仅仅是因为它是如此容易实现。这导致了无数错误，漏洞和系统崩溃，在最近四十年中可能造成十亿美元的痛苦和破坏。
</code></pre></div>    </div>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">enum</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="nf">Some</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>    <span class="c">// 泛型</span>
     <span class="nb">None</span><span class="p">,</span>
 <span class="p">}</span>
 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">some_number</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
     <span class="k">let</span> <span class="n">some_string</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="s">"a string"</span><span class="p">);</span>     <span class="c">// Some 直接赋值即可推测类型了</span>
     <span class="k">let</span> <span class="n">absent_number</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nb">None</span><span class="p">;</span>  <span class="c">// None 没有类型 那么就需要指代类型</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <p>加入Option 旨在限制null的普遍性并提高Rust代码的安全性。</p>
  </li>
  <li>
    <p>匹配控制流 <code class="highlighter-rouge">match</code></p>

    <p>一个强大的武器</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">enum</span> <span class="n">UsState</span> <span class="p">{</span>
     <span class="n">Alabama</span><span class="p">,</span>
     <span class="n">Alaska</span><span class="p">,</span>
     <span class="c">// --snip--</span>
 <span class="p">}</span>

 <span class="k">enum</span> <span class="n">Coin</span> <span class="p">{</span>
     <span class="n">Penny</span><span class="p">,</span>      <span class="c">// 1 美分</span>
     <span class="n">Nickel</span><span class="p">,</span>     <span class="c">// 5 美分</span>
     <span class="n">Dime</span><span class="p">,</span>       <span class="c">// 10 美分</span>
     <span class="nf">Quarter</span><span class="p">(</span><span class="n">UsState</span><span class="p">),</span>    <span class="c">// 25 美分</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">value_in_cents</span><span class="p">(</span><span class="n">coin</span><span class="p">:</span> <span class="n">Coin</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u8</span> <span class="p">{</span>
     <span class="k">match</span> <span class="n">coin</span> <span class="p">{</span>
         <span class="c">// 类函数的调用方式 指定 枚举的每个值</span>
         <span class="nn">Coin</span><span class="p">::</span><span class="n">Penny</span> <span class="k">=&gt;</span> <span class="p">{</span>    <span class="c">// =&gt; 匹配后直接赋值的意思</span>
             <span class="nd">println!</span><span class="p">(</span><span class="s">"Lucky penny!"</span><span class="p">);</span>
             <span class="mi">1</span>   <span class="c">// 返回值为1</span>
         <span class="p">},</span>
         <span class="nn">Coin</span><span class="p">::</span><span class="n">Nickel</span> <span class="k">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
         <span class="nn">Coin</span><span class="p">::</span><span class="n">Dime</span> <span class="k">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
         <span class="nn">Coin</span><span class="p">::</span><span class="nf">Quarter</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
             <span class="nd">println!</span><span class="p">(</span><span class="s">"State quarter from {:?}!"</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
             <span class="mi">25</span>
         <span class="p">},</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">match</code> 搭配 <code class="highlighter-rouge">Option&lt;T&gt;</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">plus_one</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="k">match</span> <span class="n">x</span> <span class="p">{</span>
         <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nb">None</span><span class="p">,</span>
         <span class="nf">Some</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Some</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">let</span> <span class="n">five</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">six</span> <span class="o">=</span> <span class="nf">plus_one</span><span class="p">(</span><span class="n">five</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">none</span> <span class="o">=</span> <span class="nf">plus_one</span><span class="p">(</span><span class="nb">None</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">_</code> 占位符 类似于 <code class="highlighter-rouge">default</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">some_u8_value</span> <span class="o">=</span> <span class="mi">0u8</span><span class="p">;</span> <span class="c">// 等价于  let some_u8_value : u8 = 1; </span>
 <span class="k">match</span> <span class="n">some_u8_value</span> <span class="p">{</span>
     <span class="mi">1</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"one"</span><span class="p">),</span>
     <span class="mi">3</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"three"</span><span class="p">),</span>
     <span class="mi">5</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"five"</span><span class="p">),</span>
     <span class="mi">7</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"seven"</span><span class="p">),</span>
     <span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(),</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>就算使用了占位符 但如果我们只要匹配一种模式的话 用<code class="highlighter-rouge">match</code>有点焉用牛刀的感觉了 所以引入了 <code class="highlighter-rouge">if let</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 牛刀模式</span>
 <span class="k">let</span> <span class="n">some_u8_value</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">0u8</span><span class="p">);</span>
 <span class="k">match</span> <span class="n">some_u8_value</span> <span class="p">{</span>
     <span class="nf">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">println!</span><span class="p">(</span><span class="s">"three"</span><span class="p">),</span>
     <span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(),</span>
 <span class="p">}</span>
 <span class="c">// 简约模式</span>
 <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">some_u8_value</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"three"</span><span class="p">);</span>
 <span class="p">}</span>

</code></pre></div>    </div>

    <p>换句话说，您可以将其<code class="highlighter-rouge">if let</code>视为<code class="highlighter-rouge">match</code>当值匹配一个模式然后忽略所有其他值时运行代码的语法语法。</p>
  </li>
</ol>

<h3 id="使用包头文件">使用包(头文件)</h3>

<h4 id="包">包</h4>

<ol>
  <li>在使用<code class="highlighter-rouge">cargo</code>的时候, 生成出来的 <code class="highlighter-rouge">src</code> 其实就是一个包</li>
</ol>

<h4 id="模块-mod">模块 <code class="highlighter-rouge">mod</code></h4>

<ol>
  <li>
    <p>样板</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">mod</span> <span class="n">front_of_house</span> <span class="p">{</span>
     <span class="c">// 如果这里不添加 pub 的话 是没有办法在外部使用的</span>
     <span class="k">pub</span> <span class="k">mod</span> <span class="n">hosting</span> <span class="p">{</span>
         <span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_to_waitlist</span><span class="p">()</span> <span class="p">{}</span>
         <span class="k">fn</span> <span class="nf">seat_at_table</span><span class="p">()</span> <span class="p">{}</span>
     <span class="p">}</span>

     <span class="k">mod</span> <span class="n">serving</span> <span class="p">{</span>
         <span class="k">fn</span> <span class="nf">take_order</span><span class="p">()</span> <span class="p">{}</span>
         <span class="k">fn</span> <span class="nf">serve_order</span><span class="p">()</span> <span class="p">{}</span>
         <span class="k">fn</span> <span class="nf">take_payment</span><span class="p">()</span> <span class="p">{}</span>
     <span class="p">}</span>
 <span class="p">}</span>


 <span class="k">pub</span> <span class="k">fn</span> <span class="nf">eat_at_restaurant</span><span class="p">()</span> <span class="p">{</span>
     <span class="c">// 绝对路径调用的时候 采用的关键字是 crate 箱子 其实可以理解为当前目录 root</span>
     <span class="nn">crate</span><span class="p">::</span><span class="nn">front_of_house</span><span class="p">::</span><span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>

     <span class="c">// 相对路径调用的时候可以省略</span>
     <span class="nn">front_of_house</span><span class="p">::</span><span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>模块树</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">crate</span>
 <span class="err">└──</span> <span class="n">front_of_house</span>
     <span class="err">├──</span> <span class="n">hosting</span>
     <span class="err">│</span>   <span class="err">├──</span> <span class="n">add_to_waitlist</span>
     <span class="err">│</span>   <span class="err">└──</span> <span class="n">seat_at_table</span>
     <span class="err">└──</span> <span class="n">serving</span>
         <span class="err">├──</span> <span class="n">take_order</span>
         <span class="err">├──</span> <span class="n">serve_order</span>
         <span class="err">└──</span> <span class="n">take_payment</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>起始相对路径 <code class="highlighter-rouge">super</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">serve_order</span><span class="p">()</span> <span class="p">{}</span>

 <span class="k">mod</span> <span class="n">back_of_house</span> <span class="p">{</span>
     <span class="k">fn</span> <span class="nf">fix_incorrect_order</span><span class="p">()</span> <span class="p">{</span>
         <span class="nf">cook_order</span><span class="p">();</span>
         <span class="c">// 这里的super意思就是 back_of_house 而且 serve_order 和 super 同级</span>
         <span class="nn">super</span><span class="p">::</span><span class="nf">serve_order</span><span class="p">();</span>
     <span class="p">}</span>

     <span class="k">fn</span> <span class="nf">cook_order</span><span class="p">()</span> <span class="p">{}</span>
 <span class="p">}</span>
 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{}</span>

</code></pre></div>    </div>
  </li>
</ol>

<h4 id="使用-use-来引入路径-缩短路径">使用 <code class="highlighter-rouge">use</code> 来引入路径 缩短路径</h4>

<ol>
  <li>
    <p>正常使用</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">mod</span> <span class="n">front_of_house</span> <span class="p">{</span>
     <span class="k">pub</span> <span class="k">mod</span> <span class="n">hosting</span> <span class="p">{</span>
         <span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_to_waitlist</span><span class="p">()</span> <span class="p">{}</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="nn">front_of_house</span><span class="p">::</span><span class="n">hosting</span><span class="p">;</span>

 <span class="k">pub</span> <span class="k">fn</span> <span class="nf">eat_at_restaurant</span><span class="p">()</span> <span class="p">{</span>
     <span class="c">// 绝对路径下</span>
     <span class="nn">crate</span><span class="p">::</span><span class="nn">front_of_house</span><span class="p">::</span><span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
     <span class="c">// 相对路径下</span>
     <span class="nn">front_of_house</span><span class="p">::</span><span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
     <span class="c">// 被缩短的使用方式</span>
     <span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">as</code> 来重写命名</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Result</span><span class="p">;</span>
     <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Result</span> <span class="k">as</span> <span class="n">IoResult</span><span class="p">;</span>

     <span class="k">fn</span> <span class="nf">function1</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span> <span class="p">{</span>
         <span class="c">// --snip--</span>
         <span class="nf">Ok</span><span class="p">(())</span>
     <span class="p">}</span>

     <span class="k">fn</span> <span class="nf">function2</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">IoResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
         <span class="c">// --snip--</span>
         <span class="nf">Ok</span><span class="p">(())</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>导出 <code class="highlighter-rouge">pub use</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">mod</span> <span class="n">front_of_house</span> <span class="p">{</span>
     <span class="k">pub</span> <span class="k">mod</span> <span class="n">hosting</span> <span class="p">{</span>
         <span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_to_waitlist</span><span class="p">()</span> <span class="p">{}</span>
     <span class="p">}</span>
 <span class="p">}</span>
 <span class="c">// 外部访问可以直接访问 hosting::add_to_waitlist()</span>
 <span class="k">pub</span> <span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="nn">front_of_house</span><span class="p">::</span><span class="n">hosting</span><span class="p">;</span>

 <span class="k">pub</span> <span class="k">fn</span> <span class="nf">eat_at_restaurant</span><span class="p">()</span> <span class="p">{</span>
     <span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
     <span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
     <span class="nn">hosting</span><span class="p">::</span><span class="nf">add_to_waitlist</span><span class="p">();</span>
 <span class="p">}</span>
 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{}</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p>对于同一包下的多个路径使用嵌套处理 <code class="highlighter-rouge">{ , }</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Write</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">;</span>

 <span class="k">use</span> <span class="nn">std</span><span class="p">::{</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">,</span> <span class="n">io</span><span class="p">};</span>
 <span class="c">// 对于路径本身 使用 self</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::{</span><span class="k">self</span><span class="p">,</span> <span class="n">Write</span><span class="p">};</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>导入所有的公共项目</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>模块 <code class="highlighter-rouge">mod</code> 分文件存放</p>

    <p>这个不需要太多的内容去写 大概就是和安卓的机制类似 文件夹存放即可</p>
  </li>
</ol>

<h3 id="常用的一些键值保存的东西">常用的一些键值保存的东西</h3>

<h4 id="矢量">矢量</h4>

<ol>
  <li>
    <p>矢量 <code class="highlighter-rouge">Vec</code> 可以存放任何类型, 但仅限于同一类型的, 所以可以借助 <code class="highlighter-rouge">enum</code> 来达到混存的功能</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">v</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
 <span class="n">v</span><span class="nf">.push</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
 <span class="n">v</span><span class="nf">.push</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

 <span class="k">enum</span> <span class="n">SpreadsheetCell</span> <span class="p">{</span>
     <span class="nf">Int</span><span class="p">(</span><span class="nb">i32</span><span class="p">),</span>
     <span class="nf">Float</span><span class="p">(</span><span class="nb">f64</span><span class="p">),</span>
     <span class="nf">Text</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
 <span class="p">}</span>

 <span class="k">let</span> <span class="n">row</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span>
     <span class="nn">SpreadsheetCell</span><span class="p">::</span><span class="nf">Int</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
     <span class="nn">SpreadsheetCell</span><span class="p">::</span><span class="nf">Text</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"blue"</span><span class="p">)),</span>
     <span class="nn">SpreadsheetCell</span><span class="p">::</span><span class="nf">Float</span><span class="p">(</span><span class="mf">10.12</span><span class="p">),</span>
 <span class="p">];</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>如果已经生成过了个 不可变 的引用之后, 再继续对其push</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="k">mut</span> <span class="n">v</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
 <span class="k">let</span> <span class="n">first</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  <span class="c">// 产生不可变的引用之后</span>
 <span class="n">v</span><span class="nf">.push</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>          <span class="c">// 这里会生成 可变</span>
 <span class="nd">println!</span><span class="p">(</span><span class="s">"The first element is: {}"</span><span class="p">,</span> <span class="n">first</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>可以直接对其遍历</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">57</span><span class="p">];</span>
 <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="o">&amp;</span><span class="n">v</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="c">// 如果要改值得话 需要加 mut</span>
 <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">v</span> <span class="p">{</span>
     <span class="c">// 甚至是直接遍历的时候更改他的值</span>
     <span class="o">*</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">50</span><span class="p">;</span> <span class="c">// * 有点强买强卖的问道</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="string">String</h4>

<ol>
  <li>
    <p>不能对 <code class="highlighter-rouge">String</code> 索引</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">hello</span> <span class="o">=</span> <span class="s">"Здравствуйте"</span><span class="p">;</span>
 <span class="k">let</span> <span class="n">answer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hello</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c">// 因为Unicode吗的字节长度是不定的</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>字符串的一些相关操作</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 追加</span>
 <span class="k">let</span> <span class="k">mut</span> <span class="n">s1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"foo"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"bar"</span><span class="p">;</span>
 <span class="n">s1</span><span class="nf">.push_str</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span> <span class="c">// 这里并不会转让所有权</span>
 <span class="nd">println!</span><span class="p">(</span><span class="s">"s2 is {}"</span><span class="p">,</span> <span class="n">s2</span><span class="p">);</span>

 <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"lo"</span><span class="p">);</span>
 <span class="n">s</span><span class="nf">.push</span><span class="p">(</span><span class="sc">'l'</span><span class="p">);</span>

 <span class="c">// 合并</span>
 <span class="c">// 加号</span>
 <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Hello, "</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"world!"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">;</span> <span class="c">// s1 的所有权被移交出去了 + 号其实调用的是 add 方法</span>

 <span class="c">// 格式化</span>
 <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"tic"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"tac"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s3</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"toe"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"{}-{}-{}"</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>但可以对字符串做范围切片 但是会可能报错</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">hello</span> <span class="o">=</span> <span class="s">"Здравствуйте"</span><span class="p">;</span> <span class="c">// 这里的一个字符占两个字节</span>
 <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hello</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">4</span><span class="p">];</span>       <span class="c">// 所以 0到4 取出来的是 'Зд'</span>
 <span class="c">// 一旦取了 [0..1] 或者是 [0..3] 就会导致字符无法被正常切出来 会报错</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>遍历字符串的真正字符 使用 <code class="highlighter-rouge">chars</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">for</span> <span class="n">c</span> <span class="n">in</span> <span class="s">"नमस्ते"</span><span class="nf">.chars</span><span class="p">()</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>或者遍历字符串的字节码 使用 <code class="highlighter-rouge">bytes</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">for</span> <span class="n">b</span> <span class="n">in</span> <span class="s">"नमस्ते"</span><span class="nf">.bytes</span><span class="p">()</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="hashmap">HashMap</h4>

<ol>
  <li>
    <p>所有的键值必须一致, 也就是键的类型要一致, 值的类型也要一致</p>
  </li>
  <li>
    <p>使用</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

 <span class="k">let</span> <span class="k">mut</span> <span class="n">scores</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
 <span class="c">// 一个一个插入</span>
 <span class="n">scores</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
 <span class="n">scores</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Yellow"</span><span class="p">),</span> <span class="mi">50</span><span class="p">);</span>

 <span class="c">// 先创建所有的键 和 值 存放到 vec当中</span>
 <span class="k">let</span> <span class="n">teams</span>  <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">),</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Yellow"</span><span class="p">)];</span>
 <span class="k">let</span> <span class="n">initial_scores</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">];</span>

 <span class="c">// 这里的 下划线是可以编译器 自己去猜测的</span>
 <span class="k">let</span> <span class="n">scores</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">teams</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.zip</span><span class="p">(</span><span class="n">initial_scores</span><span class="nf">.iter</span><span class="p">())</span><span class="nf">.collect</span><span class="p">();</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>会接收所有权</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">field_name</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Favorite color"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">field_value</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">);</span>

 <span class="k">let</span> <span class="k">mut</span> <span class="n">map</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
 <span class="n">map</span><span class="nf">.insert</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span><span class="p">);</span>
 <span class="c">// 下面这行代码会报错的 所有权失效了</span>
 <span class="nd">println!</span><span class="p">(</span><span class="s">"{}, {}"</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>获取值 <code class="highlighter-rouge">get</code> 返回的是个 <code class="highlighter-rouge">Option</code> 值 因为是有可能为 <code class="highlighter-rouge">None</code>的</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">scores</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
 <span class="n">scores</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Yellow"</span><span class="p">),</span> <span class="mi">50</span><span class="p">);</span>

 <span class="k">let</span> <span class="n">team_name</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">);</span>
 <span class="k">let</span> <span class="n">score</span> <span class="o">=</span> <span class="n">scores</span><span class="nf">.get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">team_name</span><span class="p">);</span>
 <span class="c">// score =&gt; Some(10)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>仅当键没有值时才插入值 <code class="highlighter-rouge">entry</code> <code class="highlighter-rouge">or_insert</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="k">mut</span> <span class="n">scores</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
 <span class="n">scores</span><span class="nf">.insert</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>

 <span class="n">scores</span><span class="nf">.entry</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Yellow"</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
 <span class="n">scores</span><span class="nf">.entry</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>   <span class="c">// 这里不会生效</span>

 <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">scores</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>更新值 但这里感觉有点问题</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="s">"hello world wonderful world"</span><span class="p">;</span>

 <span class="k">let</span> <span class="k">mut</span> <span class="n">map</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

 <span class="k">for</span> <span class="n">word</span> <span class="n">in</span> <span class="n">text</span><span class="nf">.split_whitespace</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">count</span> <span class="o">=</span> <span class="n">map</span><span class="nf">.entry</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
     <span class="o">*</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c">// 在这里更新了 但是就怎么那么怪呢</span>
 <span class="p">}</span>

 <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">map</span><span class="p">);</span>


 <span class="c">// 如果按照上述这个思路的话</span>
 <span class="k">let</span> <span class="n">score</span> <span class="o">=</span> <span class="n">scores</span><span class="nf">.entry</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Blue"</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
 <span class="o">*</span><span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="报错-panic">报错 <code class="highlighter-rouge">panic!</code></h3>

<ol>
  <li>
    <p>关于 <code class="highlighter-rouge">panic!</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">Result</code></p>

    <p>这是一个枚举, 表示这个值可以是有两种结果, 如果是<code class="highlighter-rouge">OK</code>会附带对应的<code class="highlighter-rouge">&lt;T&gt;</code>类型, 如果是<code class="highlighter-rouge">Err</code>的话, 将会是报错</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">enum</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="nf">Ok</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
     <span class="nf">Err</span><span class="p">(</span><span class="n">E</span><span class="p">),</span>
 <span class="p">}</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">);</span>

     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">match</span> <span class="n">f</span> <span class="p">{</span>
         <span class="nf">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">file</span><span class="p">,</span>
         <span class="nf">Err</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
             <span class="c">// 这里的 panic! 表示会直接停止在这里</span>
             <span class="nd">panic!</span><span class="p">(</span><span class="s">"Problem opening the file: {:?}"</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
         <span class="p">},</span>
     <span class="p">};</span>
 <span class="p">}</span>

 <span class="c">// 甚至可以匹配不同的错误 也就是针对 err 的错误类型做文章</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">ErrorKind</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">);</span>

     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="k">match</span> <span class="n">f</span> <span class="p">{</span>
         <span class="nf">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">file</span><span class="p">,</span>
         <span class="nf">Err</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="n">error</span><span class="nf">.kind</span><span class="p">()</span> <span class="p">{</span>
             <span class="nn">ErrorKind</span><span class="p">::</span><span class="n">NotFound</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="nn">File</span><span class="p">::</span><span class="nf">create</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span> <span class="p">{</span>
                 <span class="nf">Ok</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">fc</span><span class="p">,</span>
                 <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Problem creating the file: {:?}"</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span>
             <span class="p">},</span>
             <span class="n">other_error</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Problem opening the file: {:?}"</span><span class="p">,</span> <span class="n">other_error</span><span class="p">),</span>
         <span class="p">},</span>
     <span class="p">};</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>闭包</p>

    <p>如果在使用多个<code class="highlighter-rouge">match</code>会使得代码看起来很原始</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">ErrorKind</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(|</span><span class="n">error</span><span class="p">|</span> <span class="p">{</span>
         <span class="k">if</span> <span class="n">error</span><span class="nf">.kind</span><span class="p">()</span> <span class="o">==</span> <span class="nn">ErrorKind</span><span class="p">::</span><span class="n">NotFound</span> <span class="p">{</span>
             <span class="nn">File</span><span class="p">::</span><span class="nf">create</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(|</span><span class="n">error</span><span class="p">|</span> <span class="p">{</span>
                 <span class="nd">panic!</span><span class="p">(</span><span class="s">"Problem creating the file: {:?}"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
             <span class="p">})</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
             <span class="nd">panic!</span><span class="p">(</span><span class="s">"Problem opening the file: {:?}"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
         <span class="p">}</span>
     <span class="p">});</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>新的关键字用来单独解决报错 <code class="highlighter-rouge">unwrap</code> 和 <code class="highlighter-rouge">expect</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>   <span class="c">// 如果报错 会直接中断在这里</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to open hello.txt"</span><span class="p">);</span> <span class="c">// 如果报错 会直接显示错误信息 并且中断</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>传递报错</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>
     <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Read</span><span class="p">;</span>
     <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

     <span class="c">// 首先看返回值 是个 Result</span>
     <span class="k">fn</span> <span class="nf">read_username_from_file</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nn">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
         <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">);</span>
         <span class="c">// 判断 f 是否是错误 如果是的话直接返回报错 否则直接赋值为文件的 句柄</span>
         <span class="k">let</span> <span class="k">mut</span> <span class="n">f</span> <span class="o">=</span> <span class="k">match</span> <span class="n">f</span> <span class="p">{</span>
             <span class="nf">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">file</span><span class="p">,</span>
             <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">return</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
         <span class="p">};</span>

         <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

         <span class="c">// 匹配文件读出来的内容给到 新建的 s 当中去</span>
         <span class="k">match</span> <span class="n">f</span><span class="nf">.read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
             <span class="nf">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
             <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
         <span class="p">}</span>   <span class="c">// 这里没有 ; 表示这里就是返回值了</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>由于以上传递 非常常见 导致可以 用 <code class="highlighter-rouge">?</code> 使其精简</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Read</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">read_username_from_file</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nn">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
     <span class="n">f</span><span class="nf">.read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">s</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
     <span class="nf">Ok</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <p>该<code class="highlighter-rouge">?</code>放在后<code class="highlighter-rouge">Result</code>值定义为工作在几乎相同的方式<code class="highlighter-rouge">match</code>表达我们定义来处理<code class="highlighter-rouge">Result</code>
 也就是可以直接做到简化返回操作的能力
 甚至更加的精简</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">io</span><span class="p">::</span><span class="n">Read</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">read_username_from_file</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nn">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
     <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="o">?</span><span class="nf">.read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">s</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
     <span class="nf">Ok</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <p>好吧 其实还可以超级精简</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">read_username_from_file</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nn">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="c">// 我觉得这里已经癫了 直接帮你写好了 打开文件夹并且获取内容 并且返回出去...</span>
     <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>那么这个<code class="highlighter-rouge">?</code>能用在别的地方吗? 不能的 只能用在返回值为 <code class="highlighter-rouge">Result</code> 的函数上</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 错误代码</span>

 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <p>这里说一嘴 <code class="highlighter-rouge">main</code> 函数的返回值是 <code class="highlighter-rouge">()</code> 我完全不知道这是个什么类型…</p>

    <p>但你可以这么写</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="nn">File</span><span class="p">::</span><span class="nf">open</span><span class="p">(</span><span class="s">"hello.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
     <span class="c">// 返回了 () 的同时 耶 完成了 ?</span>
     <span class="nf">Ok</span><span class="p">(())</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <p>但这里出现了个新的玩意 <code class="highlighter-rouge">Box&lt;dyn Error&gt;</code> <code class="highlighter-rouge">Box</code> 看了文档不是很懂 <code class="highlighter-rouge">pub struct Box&lt;T: ?Sized&gt;(Unique&lt;T&gt;);</code>
 但 <code class="highlighter-rouge">dyn</code> 表示可以是任何类型
 所以 <code class="highlighter-rouge">Box&lt;dyn Error&gt;</code> 可以理解为 任何类型的错误</p>
  </li>
</ol>

<h3 id="泛型-特征-和-生命周期">泛型 特征 和 生命周期</h3>

<h4 id="特征">特征</h4>

<ol>
  <li>
    <p>定义共同接口</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">pub</span> <span class="k">trait</span> <span class="n">Summary</span> <span class="p">{</span>
     <span class="k">fn</span> <span class="nf">summarize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="k">pub</span> <span class="k">struct</span> <span class="n">NewsArticle</span> <span class="p">{</span>
     <span class="k">pub</span> <span class="n">headline</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
     <span class="k">pub</span> <span class="n">location</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
     <span class="k">pub</span> <span class="n">author</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
     <span class="k">pub</span> <span class="n">content</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
 <span class="p">}</span>

 <span class="c">// 实现接口 对于 NewsArticle 这个结构体来说</span>
 <span class="k">impl</span> <span class="n">Summary</span> <span class="k">for</span> <span class="n">NewsArticle</span> <span class="p">{</span>
     <span class="k">fn</span> <span class="nf">summarize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
         <span class="nd">format!</span><span class="p">(</span><span class="s">"{}, by {} ({})"</span><span class="p">,</span> <span class="k">self</span><span class="py">.headline</span><span class="p">,</span> <span class="k">self</span><span class="py">.author</span><span class="p">,</span> <span class="k">self</span><span class="py">.location</span><span class="p">)</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">pub</span> <span class="k">struct</span> <span class="n">Tweet</span> <span class="p">{</span>
     <span class="k">pub</span> <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
     <span class="k">pub</span> <span class="n">content</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
     <span class="k">pub</span> <span class="n">reply</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
     <span class="k">pub</span> <span class="n">retweet</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
 <span class="p">}</span>

 <span class="c">// 实现接口 对于 Tweet 这个结构体来说</span>
 <span class="k">impl</span> <span class="n">Summary</span> <span class="k">for</span> <span class="n">Tweet</span> <span class="p">{</span>
     <span class="k">fn</span> <span class="nf">summarize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
         <span class="nd">format!</span><span class="p">(</span><span class="s">"{}: {}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.username</span><span class="p">,</span> <span class="k">self</span><span class="py">.content</span><span class="p">)</span>
     <span class="p">}</span>
 <span class="p">}</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p>不能实现外部特征, 只能本地使用</p>
  </li>
  <li>
    <p>可以默认实现特征, 这样本地就都可以使用了</p>
  </li>
  <li>
    <p>特征可以作为参数, 也就是必须实现这个特征的任意类型</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 单独使用</span>
 <span class="k">pub</span> <span class="k">fn</span> <span class="nf">notify</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="k">impl</span> <span class="n">Summary</span><span class="p">)</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"Breaking news! {}"</span><span class="p">,</span> <span class="n">item</span><span class="nf">.summarize</span><span class="p">());</span>
 <span class="p">}</span>

 <span class="c">// 提取出来使用</span>
 <span class="k">pub</span> <span class="k">fn</span> <span class="n">notify</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">Summary</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"Breaking news! {}"</span><span class="p">,</span> <span class="n">item</span><span class="nf">.summarize</span><span class="p">());</span>
 <span class="p">}</span>

 <span class="c">// 正常单独使用多个</span>
 <span class="k">pub</span> <span class="k">fn</span> <span class="nf">notify</span><span class="p">(</span><span class="n">item1</span><span class="p">:</span> <span class="k">impl</span> <span class="n">Summary</span><span class="p">,</span> <span class="n">item2</span><span class="p">:</span> <span class="k">impl</span> <span class="n">Summary</span><span class="p">)</span> <span class="p">{</span>

 <span class="p">}</span>

 <span class="c">// 但可以写成这样</span>
 <span class="k">pub</span> <span class="k">fn</span> <span class="n">notify</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">Summary</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item1</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">item2</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>

 <span class="p">}</span>

 <span class="c">// 可以相加</span>
 <span class="k">pub</span> <span class="k">fn</span> <span class="nf">notify</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="k">impl</span> <span class="n">Summary</span> <span class="o">+</span> <span class="n">Display</span><span class="p">)</span> <span class="p">{</span>

 <span class="p">}</span>

 <span class="c">// 当然也可以提取出来</span>
 <span class="k">pub</span> <span class="k">fn</span> <span class="n">notify</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">Summary</span> <span class="o">+</span> <span class="n">Display</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>

 <span class="p">}</span>

 <span class="c">// 但如果有多个的时候 就会很乱</span>
 <span class="k">fn</span> <span class="n">some_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">Display</span> <span class="o">+</span> <span class="n">Clone</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">Clone</span> <span class="o">+</span> <span class="n">Debug</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">U</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>

 <span class="p">}</span>

 <span class="c">// 可以使用 where 来后续补充说明</span>
 <span class="k">fn</span> <span class="n">some_function</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">U</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span>
     <span class="k">where</span> <span class="n">T</span><span class="p">:</span> <span class="n">Display</span> <span class="o">+</span> <span class="n">Clone</span><span class="p">,</span>
         <span class="n">U</span><span class="p">:</span> <span class="n">Clone</span> <span class="o">+</span> <span class="n">Debug</span>
 <span class="p">{</span>

 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>既然能做参数, 那么也能做返回值</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">returns_summarizable</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Summary</span> <span class="p">{</span>
     <span class="n">Tweet</span> <span class="p">{</span>
         <span class="n">username</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"horse_ebooks"</span><span class="p">),</span>
         <span class="n">content</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"of course, as you probably already know, people"</span><span class="p">),</span>
         <span class="n">reply</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
         <span class="n">retweet</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span>
     <span class="p">}</span>
 <span class="p">}</span>

 <span class="c">// 但有局限性 也就是说 这样是不允许的 只允许返回一个类型</span>
 <span class="k">fn</span> <span class="nf">returns_summarizable</span><span class="p">(</span><span class="n">switch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">impl</span> <span class="n">Summary</span> <span class="p">{</span>
     <span class="k">if</span> <span class="n">switch</span> <span class="p">{</span>
         <span class="n">NewsArticle</span> <span class="p">{</span>
             <span class="c">// ...</span>
         <span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">Tweet</span> <span class="p">{</span>
             <span class="c">// ...</span>
         <span class="p">}</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>完成之前的比大小</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// PartialOrd 可以比较 Copy 可以进行拷贝 代表就是在堆上的值</span>
 <span class="k">fn</span> <span class="n">largest</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span> <span class="n">PartialOrd</span> <span class="o">+</span> <span class="nb">Copy</span><span class="o">&gt;</span><span class="p">(</span><span class="n">list</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">largest</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

     <span class="k">for</span> <span class="o">&amp;</span><span class="n">item</span> <span class="n">in</span> <span class="n">list</span><span class="nf">.iter</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">if</span> <span class="n">item</span> <span class="o">&gt;</span> <span class="n">largest</span> <span class="p">{</span>
             <span class="n">largest</span> <span class="o">=</span> <span class="n">item</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="n">largest</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="lifetime-寿命"><code class="highlighter-rouge">lifetime</code> 寿命</h4>

<ol>
  <li>三条规则
    <ol>
      <li>作为引用的参数都有其自己的寿命 <code class="highlighter-rouge">fn foo&lt;'a, 'b&gt;(x: &amp;'a i32, y: &amp;'b i32);</code></li>
      <li>如果存在一个有输入寿命的参数的时候, 那么返回的也得是这个带有寿命的参数</li>
      <li>如果有多个不同寿命参数, 但其中有的是 <code class="highlighter-rouge">&amp;self</code> 或者是 <code class="highlighter-rouge">&amp;mut self</code>, 那么就把 <code class="highlighter-rouge">self</code> 分配给所有输出寿命参数???</li>
    </ol>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// 分析 1</span>
 <span class="k">fn</span> <span class="nf">first_word</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
 <span class="c">// 由于没有指定 那么就算是 先执行第一条规则 给所有的引用参数指定寿命</span>
 <span class="k">fn</span> <span class="nf">first_word</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
 <span class="c">// 又只有一个寿命类型, 那么把输入的寿命给到输出</span>
 <span class="k">fn</span> <span class="nf">first_word</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span> <span class="p">{</span>
 <span class="c">// 那么现在，此函数所有引用都具有寿命，并且编译器可以继续进行分析，所以我们就不用编写这个寿命了</span>


 <span class="c">// 分析 2</span>
 <span class="k">fn</span> <span class="nf">longest</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
 <span class="c">// 由于没有指定 入参的寿命 所以先执行第一条规则</span>
 <span class="k">fn</span> <span class="nf">longest</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'b</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="p">{</span>
 <span class="c">// 第二条规则适用? 由于有多个不适用</span>
 <span class="c">// 第三条规则呢? 没有 self 也不适用</span>
 <span class="c">// 所以这个编译的时候 就会报错</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="自动化测试">自动化测试</h3>

<h3 id="构建命令行程序">构建命令行程序</h3>

<h3 id="闭包和迭代器">闭包和迭代器</h3>

<h4 id="闭包">闭包</h4>

<ol>
  <li>
    <p>可以不指定数据类型, 但使用的时候 不能乱用, 他不是泛型</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span>  <span class="nf">add_one_v1</span>   <span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">u32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u32</span> <span class="p">{</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>  <span class="c">// 函数 完整版</span>
 <span class="k">let</span> <span class="n">add_one_v2</span> <span class="o">=</span> <span class="p">|</span><span class="n">x</span><span class="p">:</span> <span class="nb">u32</span><span class="p">|</span> <span class="k">-&gt;</span> <span class="nb">u32</span> <span class="p">{</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">};</span> <span class="c">// 闭包 完整版</span>
 <span class="k">let</span> <span class="n">add_one_v3</span> <span class="o">=</span> <span class="p">|</span><span class="n">x</span><span class="p">|</span>             <span class="p">{</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">};</span> <span class="c">// 闭包 删除指定数据类型</span>
 <span class="k">let</span> <span class="n">add_one_v4</span> <span class="o">=</span> <span class="p">|</span><span class="n">x</span><span class="p">|</span>               <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>  <span class="p">;</span> <span class="c">// 闭包 删除花括号</span>


 <span class="c">// 但在使用后上</span>
 <span class="k">let</span> <span class="n">example_closure</span> <span class="o">=</span> <span class="p">|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span><span class="p">;</span>

 <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nf">example_closure</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hello"</span><span class="p">));</span> <span class="c">// 使用了字符串作为参数传入</span>
 <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="nf">example_closure</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                     <span class="c">// 又使用了 数字  这里会崩</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>闭包也是有特征的, 这样的话就可以作为泛型的参数传入了 <code class="highlighter-rouge">Fn</code> <code class="highlighter-rouge">FnMut</code> <code class="highlighter-rouge">FnOnce</code></p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">struct</span> <span class="n">Cacher</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
     <span class="k">where</span> <span class="n">T</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="nb">u32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">u32</span>
 <span class="p">{</span>
     <span class="n">calculation</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
     <span class="n">value</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">u32</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>闭包可以使用外部的变量</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

     <span class="k">let</span> <span class="n">equal_to_x</span> <span class="o">=</span> <span class="p">|</span><span class="n">z</span><span class="p">|</span> <span class="n">z</span> <span class="o">==</span> <span class="n">x</span><span class="p">;</span>    <span class="c">// 使用了 x</span>
     <span class="c">// fn equal_to_x(z: i32) -&gt; bool { z == x } //这个就会崩</span>

     <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

     <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nf">equal_to_x</span><span class="p">(</span><span class="n">y</span><span class="p">));</span>
 <span class="p">}</span>
</code></pre></div>    </div>

    <p>所以说闭包是会强制获取所有权的
 <code class="highlighter-rouge">FnOnce</code>    获取完后 但只能调用一次
 <code class="highlighter-rouge">FnMut</code>     可变的形式获取了值
 <code class="highlighter-rouge">Fn</code>        不可变的形式获取了值</p>
  </li>
</ol>

<h4 id="迭代器">迭代器</h4>

<ol>
  <li>
    <p>特征为 <code class="highlighter-rouge">Iterator</code> 和 具有 <code class="highlighter-rouge">next</code> 方法</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">pub</span> <span class="k">trait</span> <span class="n">Iterator</span> <span class="p">{</span>
     <span class="k">type</span> <span class="n">Item</span><span class="p">;</span>

     <span class="k">fn</span> <span class="nf">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nn">Self</span><span class="p">::</span><span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">next</code> 是会消耗掉的</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">#</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>
 <span class="k">fn</span> <span class="nf">iterator_demonstration</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">v1</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

     <span class="k">let</span> <span class="k">mut</span> <span class="n">v1_iter</span> <span class="o">=</span> <span class="n">v1</span><span class="nf">.iter</span><span class="p">();</span>

     <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">v1_iter</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">));</span>
     <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">v1_iter</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">2</span><span class="p">));</span>
     <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">v1_iter</span><span class="nf">.next</span><span class="p">(),</span> <span class="nf">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">));</span>
     <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">v1_iter</span><span class="nf">.next</span><span class="p">(),</span> <span class="nb">None</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">iterator_sum</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">v1</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
     <span class="k">let</span> <span class="n">v1_iter</span> <span class="o">=</span> <span class="n">v1</span><span class="nf">.iter</span><span class="p">();</span>
     <span class="k">let</span> <span class="n">total</span><span class="p">:</span> <span class="nb">i32</span> <span class="o">=</span> <span class="n">v1_iter</span><span class="nf">.sum</span><span class="p">();</span>
     <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>迭代器是不会自己调用的</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">let</span> <span class="n">v1</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">i32</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

 <span class="n">v1</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>   <span class="c">// 这么使用时会收到警告 说明这行代码没有起到任何作用</span>

 <span class="k">let</span> <span class="n">v2</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">v1</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf">.collect</span><span class="p">();</span>    <span class="c">// 直接进行迭代</span>

 <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>使用场景</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="nf">allow</span><span class="p">(</span><span class="n">unused_variables</span><span class="p">)]</span>
 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
 <span class="nd">#[derive(PartialEq,</span> <span class="nd">Debug)]</span>
 <span class="k">struct</span> <span class="n">Shoe</span> <span class="p">{</span>
     <span class="n">size</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
     <span class="n">style</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
 <span class="p">}</span>

 <span class="k">fn</span> <span class="nf">shoes_in_my_size</span><span class="p">(</span><span class="n">shoes</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Shoe</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">shoe_size</span><span class="p">:</span> <span class="nb">u32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Shoe</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="n">shoes</span><span class="nf">.into_iter</span><span class="p">()</span>
         <span class="nf">.filter</span><span class="p">(|</span><span class="n">s</span><span class="p">|</span> <span class="n">s</span><span class="py">.size</span> <span class="o">==</span> <span class="n">shoe_size</span><span class="p">)</span>
         <span class="nf">.collect</span><span class="p">()</span>
 <span class="p">}</span>

 <span class="nd">#[test]</span>
 <span class="k">fn</span> <span class="nf">filters_by_size</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">shoes</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span>
         <span class="n">Shoe</span> <span class="p">{</span> <span class="n">size</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"sneaker"</span><span class="p">)</span> <span class="p">},</span>
         <span class="n">Shoe</span> <span class="p">{</span> <span class="n">size</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"sandal"</span><span class="p">)</span> <span class="p">},</span>
         <span class="n">Shoe</span> <span class="p">{</span> <span class="n">size</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"boot"</span><span class="p">)</span> <span class="p">},</span>
     <span class="p">];</span>

     <span class="k">let</span> <span class="n">in_my_size</span> <span class="o">=</span> <span class="nf">shoes_in_my_size</span><span class="p">(</span><span class="n">shoes</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

     <span class="nd">assert_eq!</span><span class="p">(</span>
         <span class="n">in_my_size</span><span class="p">,</span>
         <span class="nd">vec!</span><span class="p">[</span>
             <span class="n">Shoe</span> <span class="p">{</span> <span class="n">size</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"sneaker"</span><span class="p">)</span> <span class="p">},</span>
             <span class="n">Shoe</span> <span class="p">{</span> <span class="n">size</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"boot"</span><span class="p">)</span> <span class="p">},</span>
         <span class="p">]</span>
     <span class="p">);</span>
 <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="cratesio">Crates.io</h3>

<h3 id="智能指针">智能指针</h3>

<ol>
  <li><code class="highlighter-rouge">Rc&lt;T&gt;</code> 允许对一个变量有多个所有者；<code class="highlighter-rouge">Box&lt;T&gt;</code> 和 <code class="highlighter-rouge">RefCell&lt;T&gt;</code> 只能有一个所有者。</li>
  <li><code class="highlighter-rouge">Box&lt;T&gt;</code> 允许在编译时检查是不可变还是可变的；<code class="highlighter-rouge">Rc&lt;T&gt;</code> 只允许在编译时检查不可变的引用；<code class="highlighter-rouge">RefCell&lt;T&gt;</code> 允许在运行时检查不可变或可变的引用。</li>
  <li>由于<code class="highlighter-rouge">RefCell&lt;T&gt;</code>允许在运行时检查可变引用，因此 <code class="highlighter-rouge">RefCell&lt;T&gt;</code> 即使<code class="highlighter-rouge">RefCell&lt;T&gt;</code> 是不可变的，也可以在内部改变值。</li>
</ol>

<h3 id="并发">并发</h3>

<h4 id="线程">线程</h4>

<ol>
  <li>
    <p>创建线程 <code class="highlighter-rouge">thread::spawn</code></p>
  </li>
  <li>
    <p>等待该线程跑完 <code class="highlighter-rouge">join</code> 阻塞的</p>
  </li>
  <li>
    <p>线程内使用外部的值 其实也可以看做是 闭包内使用外部变量 但闭包是在单一线程下使用的 <code class="highlighter-rouge">move</code> 是针对线程闭包的 所以 会强制获取所有权</p>
  </li>
</ol>

<h4 id="通道">通道</h4>

<ol>
  <li>
    <p>例子</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">thread</span><span class="p">;</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="n">mpsc</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">rx</span><span class="p">)</span> <span class="o">=</span> <span class="nn">mpsc</span><span class="p">::</span><span class="nf">channel</span><span class="p">();</span>

     <span class="nn">thread</span><span class="p">::</span><span class="nf">spawn</span><span class="p">(</span><span class="k">move</span> <span class="p">||</span> <span class="p">{</span>
         <span class="k">let</span> <span class="n">val</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"hi"</span><span class="p">);</span>
         <span class="n">tx</span><span class="nf">.send</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>  <span class="c">// 移交所有权</span>
     <span class="p">});</span>

     <span class="k">let</span> <span class="n">received</span> <span class="o">=</span> <span class="n">rx</span><span class="nf">.recv</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
     <span class="nd">println!</span><span class="p">(</span><span class="s">"Got: {}"</span><span class="p">,</span> <span class="n">received</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="上锁">上锁</h4>

<ol>
  <li>
    <p>互斥 和 原子引用计数</p>

    <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">sync</span><span class="p">::{</span><span class="n">Mutex</span><span class="p">,</span> <span class="nb">Arc</span><span class="p">};</span>
 <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">thread</span><span class="p">;</span>

 <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">let</span> <span class="n">counter</span> <span class="o">=</span> <span class="nn">Arc</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nn">Mutex</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
     <span class="k">let</span> <span class="k">mut</span> <span class="n">handles</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>

     <span class="k">for</span> <span class="n">_</span> <span class="n">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">10</span> <span class="p">{</span>
         <span class="k">let</span> <span class="n">counter</span> <span class="o">=</span> <span class="nn">Arc</span><span class="p">::</span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">counter</span><span class="p">);</span>
         <span class="k">let</span> <span class="n">handle</span> <span class="o">=</span> <span class="nn">thread</span><span class="p">::</span><span class="nf">spawn</span><span class="p">(</span><span class="k">move</span> <span class="p">||</span> <span class="p">{</span>
             <span class="k">let</span> <span class="k">mut</span> <span class="n">num</span> <span class="o">=</span> <span class="n">counter</span><span class="nf">.lock</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

             <span class="o">*</span><span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="p">});</span>
         <span class="n">handles</span><span class="nf">.push</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">for</span> <span class="n">handle</span> <span class="n">in</span> <span class="n">handles</span> <span class="p">{</span>
         <span class="n">handle</span><span class="nf">.join</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
     <span class="p">}</span>

     <span class="nd">println!</span><span class="p">(</span><span class="s">"Result: {}"</span><span class="p">,</span> <span class="o">*</span><span class="n">counter</span><span class="nf">.lock</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">());</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

  </div>

  
    <div class="post-comments" itemprop="comment">
      

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://danyow.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


<script id="dsq-count-scr" src="//danyow.disqus.com/count.js" async></script>


    </div>
  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy;  - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://blog.danyow.cn/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
