---
layout: post
title: 'Rust'
categories: Mac Rust 笔记
comments: true
date: 2019-12-04 22:39:06 +0800
published: true
---

Title: Mac 下学习使用 *Rust*

## 安装

### brew 安装

测试之后, 环境有很多内容有没安装上, 估计也是没有配置环境的原因

### 官网方法

1. `curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh`

2. 导入环境参数 `export PATH="$PATH:$HOME/.cargo/bin"`

3. `rustc --version`

## 入门

### rustc 编译

随便写一个 `main.rs` 文件, 然后键入下述内容.

```rust
fn main() {
    println!("Hello, world!");
}
```

然后执行`rustc main.rs`得到编译后的可执行文件`./main`即可看到打印

### Cargo

如果安装的时候用的是官网的方法的话, 是会让你选择第几个安装方式, 我们通常选择第一个采用默认的方式, 这样就会把Cargo所需要的也就一起下载安装下来了. 在到我们配置环境输入的`PATH`也是一样

1. 新建项目
   `cargo new hello_cargo`

2. 编译项目
   `cargo build` or `cargo build --release`

3. 运行项目
   `cargo run`

### 编写猜谜游戏

1. 直接编写

    ```rust
    use std::io;    // 使用标准库的io

    fn main() {
        println!("Guess the number!");

        println!("Please input your guess.");

        let mut guess = String::new(); // 定义一个可变的变量

        io::stdin().read_line(&mut guess)   // 换行的原因只是因为过长了
            .expect("Failed to read line"); // 处理可能的报错

        println!("You guessed: {}", guess);
    }
    ```

2. 加入`rand`库

    在`Cargo.toml`文件中加入

    ```toml
    [dependencies]

    rand = "0.3.14"
    ```

    然后编译`cargo build`或者是`cargo run`可能会遇到
    `Blocking waiting for file lock on package cache`
    如果执行得是`cargo update`就不会遇到`Cargo.lock`文件了

    这里指定了`0.3.14`版本并不是真的就只使用该版本, 而是会使用兼容该版本的更高版本

    ```rust
    use std::io;
    use rand::Rng;  // 导入 随机库

    fn main() {
        println!("Guess the number!");

        let secret_number = rand::thread_rng().gen_range(1, 101);   // 生成一个 0 ~ 100 的随机数

        println!("The secret number is: {}", secret_number);    // 测试打印

        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin().read_line(&mut guess)
            .expect("Failed to read line");

        // trim 的是就是删除某些东西 由于 键入的时候最后面会敲击回车 导致\n会加入进来
        let guess: u32 = guess.trim().parse()   // 用 同一个变量名 去覆盖 guess 并转成 u32类型
            .expect("Please type a number!");   // 转换类型也是有可能报错的

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => println!("You win!"),
        }
    }
    ```

3. 加入循环

    ```rust
    // --snip--

        println!("The secret number is: {}", secret_number);

        loop {  // 加入循环
            println!("Please input your guess.");

            // --snip--

            match guess.cmp(&secret_number) {
                Ordering::Less => println!("Too small!"),
                Ordering::Greater => println!("Too big!"),
                Ordering::Equal => {
                    println!("You win!");
                    break;  // 在这里退出循环
                },
            }
        }
    }
    ```

4. 处理非数字的输入

    ```rust
    // --snip--

    io::stdin().read_line(&mut guess)
        .expect("Failed to read line");

    // 加入match来对报错的 continue来处理非数字的输入
    let guess: u32 = match guess.trim().parse() {
        Ok(num) => num,
        Err(_) => continue,
    };

    println!("You guessed: {}", guess);

    // --snip--
    ```
